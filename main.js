(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{k:()=>G});var t=document.querySelector(".page"),r=t.querySelector(".content"),n=t.querySelectorAll(".popup"),o={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},c=t.querySelector(".profile__edit"),a=t.querySelector(".profile__add-button"),i=t.querySelector(".profile__title"),u=t.querySelector(".profile__description"),l=(r.querySelector(".profile__image"),document.forms.edit_profile),s=t.querySelector(".popup__profile"),d=(t.querySelector(".popup__close"),t.querySelector(".popup__avatar")),f=document.querySelector("#edit_avatar"),p=document.querySelector("#avatar-link"),_=(d.querySelector("#save-avatar"),document.querySelector(".profile__image")),m=r.querySelector(".profile__avatar-edit"),y=d.querySelector(".form__submit[name=create-avatar-button]"),v=t.querySelector(".popup__card"),h=(v.querySelector(".popup__close_card"),document.querySelector(".form_type_place")),S=v.querySelector(".form__submit[name=create-card-button]"),b=t.querySelector(".form"),q=(b.querySelector(".form__input"),b.querySelector(".form__input[name=name]")),L=b.querySelector(".form__input[name=description]"),E=t.querySelector("#fullsize"),k=E.querySelector(".popup__image"),C=E.querySelector(".popup__place"),g=(document.querySelector(".popup__close_img"),t.querySelector(".cards")),A=document.querySelector(".card-template").content,x=function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""};function U(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(r.inactiveButtonClass)):(t.disabled=!0,t.classList.add(r.inactiveButtonClass))}function w(e){var t=e.querySelector(o.formSelector);t.querySelectorAll(o.inputSelector).forEach((function(e){x(t,e,o)}))}function O(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P)}function j(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P)}function P(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))}var T={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"a4afe3fb-fc08-4be7-8f57-5e8ad24d8399","Content-Type":"application/json"}};function B(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function D(e){console.log("Ошибка: ".concat(e))}function N(e,t,r,n,o){var c=A.cloneNode(!0),a=c.querySelector(".card__title"),i=c.querySelector(".card__photo"),u=c.querySelector(".card__remove"),l=c.querySelector(".card__like"),s=c.querySelector(".card__like-counter");return a.textContent=e,i.src=t,i.alt=e,s.textContent=n,o&&l.classList.add("card__like_active"),l.addEventListener("click",(function(e){!function(e,t,r){e.classList.contains("card__like_active")?function(e){return fetch("".concat(T.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:T.headers}).then(B)}(r).then((function(r){t.textContent=r.likes.length,e.classList.remove("card__like_active")})).catch((function(e){return console.error(e)})):function(e){return fetch("".concat(T.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:T.headers}).then(B)}(r).then((function(r){t.textContent=r.likes.length,e.classList.add("card__like_active")})).catch((function(e){return console.error(e)}))}(l,s,r)})),u.addEventListener("click",(function(){(function(e){return fetch("".concat(T.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:T.headers}).then(B)})(r).then((function(){u.closest(".card").remove()})).catch(D)})),i.addEventListener("click",(function(){k.src=t,k.alt=e,C.textContent=e,O(E)})),c}var I=s.querySelector(".form__button"),J=d.querySelector("#save-avatar");function z(e){i.textContent=e.name,u.textContent=e.about,_.src=e.avatar,_.alt="Аватар ".concat(e.name)}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var M,$,F=v.querySelector(".form__button");function G(e,t){e?(t.textContent="Сохранение...",t.disabled=!0):(t.classList.contains("popup__button_create")?t.textContent="Создать":t.textContent="Сохранить",t.disabled=!1)}n.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&j(e),t.target.classList.contains("popup__close")&&j(e)}))})),Promise.all([fetch("".concat(T.baseUrl,"/users/me"),{headers:T.headers}).then(B),fetch("".concat(T.baseUrl,"/cards"),{headers:T.headers}).then(B)]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c=[],a=!0,i=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?H(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];M=o._id,c.forEach((function(e){var t=N(e.name,e.link,e._id,e.likes.length,e.likes.some((function(e){return e._id===M}))),r=t.querySelector(".card__remove");e.owner._id!==M&&r.remove(),g.append(t)})),z(o)})).catch(D),c.addEventListener("click",(function(){w(s),O(s)})),l.addEventListener("submit",(function(e){var t,r;e.preventDefault(),G(!0,I),(t=q.value,r=L.value,fetch("".concat(T.baseUrl,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify({name:t,about:r})}).then(B)).then((function(e){z(e),j(s)})).catch(D).finally((function(){return G(!1,I)}))})),a.addEventListener("click",(function(){O(v)})),h.addEventListener("submit",(function(e){e.preventDefault(),G(!0,F);var t,r,n=h.name.value,o=h.link.value;(t=n,r=o,fetch("".concat(T.baseUrl,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify({name:t,link:r})}).then(B)).then((function(e){return g.prepend(N(n,o,e._id,0,!1))})).then((function(){h.reset(),S.classList.add("popup__button_disabled"),S.disabled=!0,j(v)})).catch(D).finally((function(){return G(!1,F)}))})),m.addEventListener("click",(function(){w(d),O(d)})),f.addEventListener("submit",(function(e){var t;e.preventDefault(),t=p.value,G(!0,J),function(e){return fetch("".concat(T.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify({avatar:e})}).then(B)}(t).then((function(e){_.src=e.avatar,y.classList.add("popup__button_disabled"),y.disabled=!0,f.reset(),j(d)})).catch(D).finally((function(){return G(!1,J)}))})),$=o,Array.from(document.querySelectorAll($.formSelector)).forEach((function(e){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);U(r,n,t),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?x(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,o,t),U(r,n,t)}))}))}(e,$)}))})();